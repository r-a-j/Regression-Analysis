---
title: "Project3"
author: "Raj Pawar"
date: "`r Sys.Date()`"
output: html_document
---

### Clear memory
```{r}
rm(list=ls())
```

```{r}
library(readr)
library(leaps)
library(bestglm)
library(ggplot2)
library(broom)
library(MASS)
```

## Question 1:
### Determine a linear regression model that explains the body height based on all other given variables.

### Data preparation
```{r}
bodymeasurements <- read_csv("bodymeasurements.csv", TRUE)
#View(bodymeasurements)
```

```{r}
summary(bodymeasurements)
bodymeasurements <- as.data.frame(bodymeasurements)
#bodymeasurements
```

### Check for missing values
```{r}
sum(is.na(bodymeasurements)) 
#0 missing values
```

```{r}
drops <- c("ID")
bodymeasurements <- bodymeasurements[ , !(names(bodymeasurements) %in% drops)]
```

```{r}
#bodymeasurements$Weight <- bodymeasurements$Weight/100
#summary(bodymeasurements)
```

```{r}
fit_model <- lm(Height ~ Chest+Age+Sex+Belly+Thigh+Knee+Calf+Ankle+Biceps+Wrist+Weight ,data=bodymeasurements)
summary(fit_model)
```

```{r}
fit_model_res <- augment(fit_model)
summary(fit_model_res)
```

```{r}
ggplot(fit_model_res, aes(x = .fitted, y =.resid))+geom_point()+ geom_hline(yintercept = 0)+
  xlab('Fitted values')+ylab('Residuals')+theme(axis.text=element_text(size=16), axis.title=element_text(size=16), plot.title = element_text(hjust = 0.5)) + ggtitle('Residuals vs Fitted: Price')
```

### Q-Q plot
```{r}
ggplot(data = fit_model_res, aes(sample= .std.resid)) +stat_qq() + stat_qq_line(col = 'red')+ylab('Standardized residuals')+xlab('Theoretical Quantiles')+ggtitle('Normal Q-Q: Height')+theme(axis.text=element_text(size=16), axis.title=element_text(size=16), plot.title = element_text(hjust = 0.5))
```

## Question 2:
### Find the ‘best’ set of explanatory variables for the body height using Best Subset Selection. Use the Akaike Information Criterion (AIC) and the Bayesian Information Criterion (BIC) as the selection criteria. Compare the included variables of the two resulting ‘best’ models.

### Make categorical variables as factors
```{r}
#models <- regsubsets(Height~., data = bodymeasurements, nvmax = NULL)
#summary(models)

#x <- summary(models)
#which.max(x$adjr2)
#x$which[8,]
```

```{r}
library(olsrr)
fullmodel <- lm(Height ~ ., data = bodymeasurements)
ols_step_best_subset(fullmodel)
View(ols_step_best_subset(fullmodel))
#step_model <- stepAIC(fit_model, direction= "both")
```

```{r}
bodymeasurements$Sex <- as.factor(bodymeasurements$Sex)
```

```{r}
bodymeasurements_subset <- bodymeasurements[!(names(bodymeasurements) %in% c("Knee", "Ankle", "Age"))] 
```

```{r}
col_order <- c("Sex", "Chest", "Belly" , "Thigh" , "Calf" , "Biceps" , "Wrist" , "Weight", "Height")
bodymeasurements_subset <- bodymeasurements_subset[, col_order]
summary(bodymeasurements_subset)
```

### Model-6 for BIC
```{r}
#best_subsets_BIC %>% filter(BIC == min(ols_step_best_subset$))
```

### Model-8 for AIC
```{r}
modelFull <- lm(Height ~ ., data = bodymeasurements_subset) #model with all variables
summary(modelFull)
```

### Best explanatory variables using BIC
```{r}
#bestglm(bodymeasurements_subset, IC = "BIC") # outputs the set
```

```{r}
model1 <- lm(Height ~  Sex + Belly + Thigh + Calf + Biceps + Weight, data = bodymeasurements_subset)
```

### Best explanatory variables using AIC
```{r}
#bestglm(bodymeasurements_subset, IC = "AIC")

model2 <- lm(Height ~  Chest + Sex + Belly + Thigh + Calf + Biceps + Wrist + Weight, data = bodymeasurements_subset)

```

### Verify the models created from the subset selections
```{r}
AIC(modelFull, model1, model2) # 
BIC(modelFull, model1, model2) # 
```

## Question 3:
### Estimate the ‘best’ linear model for the dependent variable w.r.t. the BIC from Task 2. Interpret the coefficients of the model and their statistical significance, provide confidence intervals for the regression parameters and evaluate the goodness of fit.

### Through BIC Model-1 is the best linear model
```{r}
summary(model1)
```

### Assumptions to check for the BIC Model
```{r}
model1_res = augment(model1)
```

### Residuals vs fitted plot
```{r}
ggplot(model1_res, aes(x = .fitted, y =.resid))+geom_point()+ geom_hline(yintercept = 0)+
  xlab('Fitted values')+ylab('Residuals')+theme(axis.text=element_text(size=16), axis.title=element_text(size=16), plot.title = element_text(hjust = 0.5)) + ggtitle('Residuals vs Fitted') +  labs(subtitle = "Estimating through best BIC model")
```

### Q-Q plot
```{r}
ggplot(data = model1_res, aes(sample= .std.resid)) +stat_qq() + stat_qq_line(col = 'red')+ylab('Standardized residuals')+xlab('Theoretical Quantiles')+ggtitle('Normal Q-Q')+theme(axis.text=element_text(size=16), axis.title=element_text(size=16), plot.title = element_text(hjust = 0.5)) + labs(subtitle = "Estimating through best BIC model")
```

### Estimating 95% confidence interval for estimated regression coefficients
```{r}
confint(model1, level = 0.95) 
```

### Estimating confidence interval for estimated regression coefficients
```{r}
round(confint(model1, level = 0.95), 2)
```

### Goodness of fit: R2
```{r}
R2 <- summary(model1)[["r.squared"]]
R2
```